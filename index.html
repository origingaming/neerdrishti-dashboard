<!DOCTYPE html>
<html>
<head>
  <title>NeNeerdrishti Live Data</title>
  <style>
    body {
      background: #111;
      color: #0f0;
      font-family: monospace;
      text-align: center;
      padding-top: 50px;
    }
    .box {
      border: 1px solid #0f0;
      padding: 20px;
      display: inline-block;
      margin-top: 20px;
    }
  </style>

  <!-- MQTT WebSocket client -->
  <script src="https://unpkg.com/paho-mqtt/mqttws31.min.js"></script>
</head>
<body>

<h2>Neerdrishti Realtime Sonar Monitor</h2>
<div>Status: <span id="status">Connecting...</span></div>

<div class="box">
  d1: <span id="d1">--</span><br>
  d2: <span id="d2">--</span><br>
  d3: <span id="d3">--</span>
</div>

<script>
  // MQTT settings
  const broker = "test.mosquitto.org";
  const port = 8081; // WebSocket SSL
  const topic = "neerdrishti/sonar/data";

  let clientID = "WebClient_" + Math.floor(Math.random()*10000);
  let client = new Paho.MQTT.Client(broker, port, clientID);

  client.onConnectionLost = () => {
    document.getElementById("status").innerText = "Disconnected";
  };

  client.onMessageArrived = (message) => {
    try {
      let data = JSON.parse(message.payloadString);
      document.getElementById("d1").innerText = data.d1;
      document.getElementById("d2").innerText = data.d2;
      document.getElementById("d3").innerText = data.d3;
    } catch(e){}
  };

  client.connect({
    useSSL: true,
    onSuccess: () => {
      document.getElementById("status").innerText = "Connected";
      client.subscribe(topic);
    },
    onFailure: () => {
      document.getElementById("status").innerText = "Connect Failed";
    }
  });
</script>

</body>
</html>

